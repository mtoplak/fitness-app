name: CI/CD Pipeline

on:
  push:
    branches: [ main, pre-production, production ]
  pull_request:
    branches: [ main, pre-production, production ]

jobs:
  # Frontend Testing Job
  frontend-tests:
    name: Frontend Tests
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      
      - name: Install dependencies
        working-directory: ./frontend
        run: npm ci
      
      - name: Run tests with coverage
        working-directory: ./frontend
        run: npm run test:coverage
      
      - name: Upload frontend coverage reports
        uses: actions/upload-artifact@v4
        with:
          name: frontend-coverage-report
          path: frontend/coverage/
          retention-days: 30
      
      - name: Display coverage summary
        working-directory: ./frontend
        run: |
          echo "## ðŸ“Š Frontend Test Coverage" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ -f coverage/coverage-summary.json ]; then
            echo "| Metric | Coverage |" >> $GITHUB_STEP_SUMMARY
            echo "|--------|----------|" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/coverage-summary.json').total; '| ðŸ“ Lines | '+d.lines.pct+'% ('+d.lines.covered+'/'+d.lines.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/coverage-summary.json').total; '| ðŸ“‹ Statements | '+d.statements.pct+'% ('+d.statements.covered+'/'+d.statements.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/coverage-summary.json').total; '| ðŸ”€ Branches | '+d.branches.pct+'% ('+d.branches.covered+'/'+d.branches.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/coverage-summary.json').total; '| âš¡ Functions | '+d.functions.pct+'% ('+d.functions.covered+'/'+d.functions.total+') |'" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ Coverage summary not generated." >> $GITHUB_STEP_SUMMARY
          fi

  # Backend Testing Job
  backend-tests:
    name: Backend Tests
    runs-on: ubuntu-latest
    
    services:
      mongodb:
        image: mongo:7
        ports:
          - 27017:27017
        options: >-
          --health-cmd "mongosh --eval 'db.adminCommand({ping: 1})'"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: server/package-lock.json
      
      - name: Install dependencies
        working-directory: ./server
        run: npm ci
      
      - name: Run tests with coverage
        working-directory: ./server
        env:
          MONGODB_URI: mongodb://localhost:27017/fitness-app-test
          JWT_SECRET: test-secret-key-for-ci
          NODE_ENV: test
        run: npm test
      
      - name: Upload backend coverage reports
        uses: actions/upload-artifact@v4
        with:
          name: backend-coverage-report
          path: server/coverage/
          retention-days: 30
      
      - name: Display coverage summary
        working-directory: ./server
        run: |
          echo "## ðŸ“Š Backend Test Coverage" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ -f coverage/coverage-summary.json ]; then
            echo "| Metric | Coverage |" >> $GITHUB_STEP_SUMMARY
            echo "|--------|----------|" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/coverage-summary.json').total; '| ðŸ“ Lines | '+d.lines.pct+'% ('+d.lines.covered+'/'+d.lines.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/coverage-summary.json').total; '| ðŸ“‹ Statements | '+d.statements.pct+'% ('+d.statements.covered+'/'+d.statements.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/coverage-summary.json').total; '| ðŸ”€ Branches | '+d.branches.pct+'% ('+d.branches.covered+'/'+d.branches.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/coverage-summary.json').total; '| âš¡ Functions | '+d.functions.pct+'% ('+d.functions.covered+'/'+d.functions.total+') |'" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ Coverage summary not generated." >> $GITHUB_STEP_SUMMARY
          fi

  # Combined Coverage Report Job
  coverage-report:
    name: Combined Coverage Report
    needs: [frontend-tests, backend-tests]
    runs-on: ubuntu-latest
    
    steps:
      - name: Download frontend coverage
        uses: actions/download-artifact@v4
        with:
          name: frontend-coverage-report
          path: ./coverage/frontend
      
      - name: Download backend coverage
        uses: actions/download-artifact@v4
        with:
          name: backend-coverage-report
          path: ./coverage/backend
      
      - name: Display combined coverage info
        run: |
          echo "# ðŸŽ¯ Combined Test Coverage Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "## ðŸŽ¨ Frontend Coverage" >> $GITHUB_STEP_SUMMARY
          if [ -f ./coverage/frontend/coverage-summary.json ]; then
            echo "| Metric | Coverage |" >> $GITHUB_STEP_SUMMARY
            echo "|--------|----------|" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/frontend/coverage-summary.json').total; '| ðŸ“ Lines | '+d.lines.pct+'% ('+d.lines.covered+'/'+d.lines.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/frontend/coverage-summary.json').total; '| ðŸ“‹ Statements | '+d.statements.pct+'% ('+d.statements.covered+'/'+d.statements.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/frontend/coverage-summary.json').total; '| ðŸ”€ Branches | '+d.branches.pct+'% ('+d.branches.covered+'/'+d.branches.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/frontend/coverage-summary.json').total; '| âš¡ Functions | '+d.functions.pct+'% ('+d.functions.covered+'/'+d.functions.total+') |'" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ Coverage data not available" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## âš™ï¸ Backend Coverage" >> $GITHUB_STEP_SUMMARY
          if [ -f ./coverage/backend/coverage-summary.json ]; then
            echo "| Metric | Coverage |" >> $GITHUB_STEP_SUMMARY
            echo "|--------|----------|" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/backend/coverage-summary.json').total; '| ðŸ“ Lines | '+d.lines.pct+'% ('+d.lines.covered+'/'+d.lines.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/backend/coverage-summary.json').total; '| ðŸ“‹ Statements | '+d.statements.pct+'% ('+d.statements.covered+'/'+d.statements.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/backend/coverage-summary.json').total; '| ðŸ”€ Branches | '+d.branches.pct+'% ('+d.branches.covered+'/'+d.branches.total+') |'" >> $GITHUB_STEP_SUMMARY
            node -pe "const d=require('./coverage/backend/coverage-summary.json').total; '| âš¡ Functions | '+d.functions.pct+'% ('+d.functions.covered+'/'+d.functions.total+') |'" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ Coverage data not available" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“ **Detailed HTML reports** are available as artifacts in the Actions tab above." >> $GITHUB_STEP_SUMMARY
          echo "ðŸ’¾ **Download artifacts:** \`frontend-coverage-report\` and \`backend-coverage-report\`" >> $GITHUB_STEP_SUMMARY

  sonarcloud:
    name: SonarCloud Analysis
    needs: [frontend-tests, backend-tests]
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Download frontend coverage
        uses: actions/download-artifact@v4
        with:
          name: frontend-coverage-report
          path: ./frontend/coverage
      
      - name: Download backend coverage
        uses: actions/download-artifact@v4
        with:
          name: backend-coverage-report
          path: ./server/coverage
      
      - name: SonarCloud Scan
        uses: SonarSource/sonarcloud-github-action@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

      - name: Check Quality Gate Status
        uses: sonarsource/sonarqube-quality-gate-action@master
        timeout-minutes: 10
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        continue-on-error: false
      
      - name: Quality Gate Success
        if: success()
        run: |
          # print to job log
          echo "## âœ… Quality Gate - SUCCESS"
          echo ""
          echo "All quality standards passed."
          echo "Deployment may proceed."

          if [ -n "$GITHUB_STEP_SUMMARY" ]; then
            echo "## âœ… Quality Gate - SUCCESS" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "All quality standards passed." >> $GITHUB_STEP_SUMMARY
            echo "Deployment may proceed." >> $GITHUB_STEP_SUMMARY
          fi
      
      - name: Quality Gate Failed
        if: failure()
        run: |

          if [ -n "$GITHUB_STEP_SUMMARY" ]; then
            echo "## âŒ Quality Gate - FAILED" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "âš ï¸ Quality gates were not met!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Deployment is blocked. Please fix issues in SonarCloud." >> $GITHUB_STEP_SUMMARY
          fi
          exit 1

  build-frontend:
    name: Build Frontend
    needs: frontend-tests
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Cache node modules
        uses: actions/cache@v4
        with:
          path: frontend/node_modules
          key: ${{ runner.os }}-frontend-node-${{ hashFiles('frontend/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-frontend-node-
      
      - name: Install dependencies
        working-directory: ./frontend
        run: npm ci
      
      - name: Build application
        working-directory: ./frontend
        run: npm run build
        env:
          NODE_ENV: production
      
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: frontend-build
          path: frontend/dist/
          retention-days: 7
      
      - name: Display build info
        run: |
          echo "## ðŸŽ¨ Frontend Build Complete" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Build artifacts saved" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“¦ Artifact name: \`frontend-build\`" >> $GITHUB_STEP_SUMMARY

  build-backend:
    name: Build Backend
    needs: backend-tests
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Cache node modules
        uses: actions/cache@v4
        with:
          path: server/node_modules
          key: ${{ runner.os }}-backend-node-${{ hashFiles('server/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-backend-node-
      
      - name: Install dependencies
        working-directory: ./server
        run: npm ci
      
      - name: Build application
        working-directory: ./server
        run: npm run build
      
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: backend-build
          path: server/dist/
          retention-days: 7
      
      - name: Display build info
        run: |
          echo "## âš™ï¸ Backend Build Complete" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Build artifacts saved" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“¦ Artifact name: \`backend-build\`" >> $GITHUB_STEP_SUMMARY

  deploy-github-pages:
    name: Deploy to GitHub Pages
    needs: [frontend-tests, backend-tests]
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/production')
    
    permissions:
      contents: read
      pages: write
      id-token: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Pages
        uses: actions/configure-pages@v4
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
      
      - name: Display deployment info
        run: |
          echo "## ðŸ“„ GitHub Pages Deployed" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Static site deployed successfully" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— URL: ${{ steps.deployment.outputs.page_url }}" >> $GITHUB_STEP_SUMMARY

  # Development Environment - Docker Build & Push
  docker-build-push-dev:
    name: Build & Push Docker Images (Development)
    needs: [build-frontend, build-backend]
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    environment:
      name: Development
      url: https://hub.docker.com/
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Log in to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      
      - name: Build and push Frontend image (dev)
        uses: docker/build-push-action@v5
        with:
          context: ./frontend
          file: ./frontend/Dockerfile
          push: true
          tags: |
            ${{ secrets.DOCKER_USERNAME }}/fitness-app-frontend:dev
            ${{ secrets.DOCKER_USERNAME }}/fitness-app-frontend:dev-${{ github.sha }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
      
      - name: Build and push Backend image (dev)
        uses: docker/build-push-action@v5
        with:
          context: ./server
          file: ./server/Dockerfile
          push: true
          tags: |
            ${{ secrets.DOCKER_USERNAME }}/fitness-app-backend:dev
            ${{ secrets.DOCKER_USERNAME }}/fitness-app-backend:dev-${{ github.sha }}
          cache-from: type=gha
          cache-to: type=gha,mode=max
      
      - name: Display Docker info
        run: |
          echo "## ðŸ³ Docker Images Published (Development)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Frontend Image" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "${{ secrets.DOCKER_USERNAME }}/fitness-app-frontend:dev" >> $GITHUB_STEP_SUMMARY
          echo "${{ secrets.DOCKER_USERNAME }}/fitness-app-frontend:dev-${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Backend Image" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "${{ secrets.DOCKER_USERNAME }}/fitness-app-backend:dev" >> $GITHUB_STEP_SUMMARY
          echo "${{ secrets.DOCKER_USERNAME }}/fitness-app-backend:dev-${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY

  # Production Environment - Docker Build & Push
  docker-build-push-prod:
    name: Build & Push Docker Images (Production)
    needs: [build-frontend, build-backend]
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/production'
    environment:
      name: Production
      url: https://hub.docker.com/
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Log in to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      
      - name: Build and push Frontend image (prod)
        uses: docker/build-push-action@v5
        with:
          context: ./frontend
          file: ./frontend/Dockerfile
          push: true
          tags: |
            ${{ secrets.DOCKER_USERNAME }}/fitness-app-frontend:prod
            ${{ secrets.DOCKER_USERNAME }}/fitness-app-frontend:prod-${{ github.sha }}
            ${{ secrets.DOCKER_USERNAME }}/fitness-app-frontend:latest
          cache-from: type=gha
          cache-to: type=gha,mode=max
      
      - name: Build and push Backend image (prod)
        uses: docker/build-push-action@v5
        with:
          context: ./server
          file: ./server/Dockerfile
          push: true
          tags: |
            ${{ secrets.DOCKER_USERNAME }}/fitness-app-backend:prod
            ${{ secrets.DOCKER_USERNAME }}/fitness-app-backend:prod-${{ github.sha }}
            ${{ secrets.DOCKER_USERNAME }}/fitness-app-backend:latest
          cache-from: type=gha
          cache-to: type=gha,mode=max
      
      - name: Display Docker info
        run: |
          echo "## ðŸ³ Docker Images Published (Production)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Frontend Image" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "${{ secrets.DOCKER_USERNAME }}/fitness-app-frontend:prod" >> $GITHUB_STEP_SUMMARY
          echo "${{ secrets.DOCKER_USERNAME }}/fitness-app-frontend:prod-${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "${{ secrets.DOCKER_USERNAME }}/fitness-app-frontend:latest" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Backend Image" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "${{ secrets.DOCKER_USERNAME }}/fitness-app-backend:prod" >> $GITHUB_STEP_SUMMARY
          echo "${{ secrets.DOCKER_USERNAME }}/fitness-app-backend:prod-${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "${{ secrets.DOCKER_USERNAME }}/fitness-app-backend:latest" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY

  deploy-render-dev:
    name: Deploy Backend to Render (Development)
    needs: docker-build-push-dev
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    environment:
      name: Development
      url: https://dashboard.render.com/
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Deploy Backend to Render (Development)
        env:
          RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
          RENDER_SERVICE_ID: ${{ secrets.RENDER_BACKEND_SERVICE_ID }}
        run: |
          curl -X POST "https://api.render.com/v1/services/${RENDER_SERVICE_ID}/deploys" \
            -H "Authorization: Bearer ${RENDER_API_KEY}" \
            -H "Content-Type: application/json" \
            -d '{"clearCache": false}'
      
      - name: Wait for backend deployment
        run: sleep 30
      
      - name: Display deployment info
        run: |
          echo "## ðŸš€ Deployment to Render (Development)" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Backend deployment triggered" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— Check status at: https://dashboard.render.com/" >> $GITHUB_STEP_SUMMARY

  deploy-render-prod:
    name: Deploy Backend to Render (Production)
    needs: docker-build-push-prod
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/production'
    environment:
      name: Production
      url: https://dashboard.render.com/
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Deploy Backend to Render (Production)
        env:
          RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
          RENDER_SERVICE_ID_PROD: ${{ secrets.RENDER_BACKEND_SERVICE_ID_PROD }}
        run: |
          curl -X POST "https://api.render.com/v1/services/${RENDER_SERVICE_ID_PROD}/deploys" \
            -H "Authorization: Bearer ${RENDER_API_KEY}" \
            -H "Content-Type: application/json" \
            -d '{"clearCache": false}'
      
      - name: Display deployment info
        run: |
          echo "## ðŸš€ Deployment to Render (Production)" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Backend deployment triggered" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— Check status at: https://dashboard.render.com/" >> $GITHUB_STEP_SUMMARY

  deploy-vercel-dev:
    name: Deploy Frontend to Vercel (Development)
    needs: build-frontend
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    environment:
      name: Development
      url: https://vercel.com/dashboard
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Download build artifacts
        uses: actions/download-artifact@v4
        with:
          name: frontend-build
          path: frontend/dist
      
      - name: Install Vercel CLI
        run: npm install -g vercel
      
      - name: Deploy to Vercel (Development)
        working-directory: ./frontend
        run: vercel deploy --token=${{ secrets.VERCEL_TOKEN }}
        id: vercel-deploy
      
      - name: Display deployment info
        run: |
          echo "## ðŸŒ Frontend Deployed to Vercel (Development)" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Deployment successful" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— Check your Vercel dashboard for the live URL" >> $GITHUB_STEP_SUMMARY

  deploy-vercel-prod:
    name: Deploy Frontend to Vercel (Production)
    needs: build-frontend
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/production'
    environment:
      name: Production
      url: https://vercel.com/dashboard
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Download build artifacts
        uses: actions/download-artifact@v4
        with:
          name: frontend-build
          path: frontend/dist
      
      - name: Install Vercel CLI
        run: npm install -g vercel
      
      - name: Deploy to Vercel (Production)
        working-directory: ./frontend
        run: vercel deploy --prod --token=${{ secrets.VERCEL_TOKEN }}
        id: vercel-deploy
      
      - name: Display deployment info
        run: |
          echo "## ðŸŒ Frontend Deployed to Vercel (Production)" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Deployment successful" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— Check your Vercel dashboard for the live URL" >> $GITHUB_STEP_SUMMARY
